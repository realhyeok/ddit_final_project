<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Task-Mapper">

	<select id="selectTaskCountByProjectNo" parameterType="String">
		SELECT
			COUNT(*)
		FROM
			TASK
		WHERE
			PROJ_NO = #{projNo}
	</select>

	<select id="selectTaskCountInProjByUserId" resultType="int" parameterType="User">
		SELECT
			COUNT(*)
		FROM
			TASK A
		JOIN
			USER_PROJECT B ON(A.USER_ID = B.USER_ID AND A.PROJ_NO = B.PROJ_NO)
		WHERE
			A.USER_ID = #{userId}
		  AND
            A.PROJ_NO = #{projNo}
	</select>

	<select id="selectTaskListByProjectNo" resultType="task" parameterType="String">
		SELECT
        	A.TASK_NO AS TASK_NO,
            A.TITLE AS TITLE,
            B.NICKNAME AS USER_ID,
            A.CONTENT AS CONTENT,
            A.IMPORTANT AS IMPORTANT,
            A.REGDATE AS REGDATE,
            A.UPDATEDATE AS UPDATEDATE,
            A.STARTDATE AS STARTDATE,
            A.ENDDATE AS ENDDATE,
            A.STATUS AS STATUS,
            A.DOC_CONT_NO AS DOC_CONT_NO
		FROM
        	TASK A
		JOIN
			"USER" B ON A.USER_ID = B.USER_ID
		WHERE
			A.PROJ_NO = #{projNo}
	</select>

	<select id="selectTaskDetailByTaskNo" resultType="task" parameterType="task">
		SELECT
        	A.TASK_NO AS TASK_NO,
            A.TITLE AS TITLE,
            B.NICKNAME AS USER_ID,
            A.CONTENT AS CONTENT,
            A.IMPORTANT AS IMPORTANT,
            A.REGDATE AS REGDATE,
            A.UPDATEDATE AS UPDATEDATE,
            A.STARTDATE AS STARTDATE,
            A.ENDDATE AS ENDDATE,
            A.STATUS AS STATUS,
            A.DOC_CONT_NO AS DOC_CONT_NO
		FROM
        	TASK A
		JOIN
			"USER" B ON A.USER_ID = B.USER_ID
		WHERE
			A.PROJ_NO = #{projNo}
		AND
			A.TASK_NO = #{taskNo}
	</select>

	<insert id="insertTask" parameterType="task">
		INSERT INTO TASK (
		    TASK_NO   ,PROJ_NO   ,TITLE   ,USER_ID   ,CONTENT
		    ,IMPORTANT   ,REGDATE   ,UPDATEDATE   ,STATUS
		    ,DOC_CONT_NO   ,STARTDATE   ,ENDDATE
		) VALUES (
		    #{taskNo}   ,#{projNo}   ,#{title}   ,#{userId}   ,#{content}
		    ,#{important}   ,sysdate   ,sysdate   ,#{status}
		    ,1   ,#{startdate}   ,#{enddate}
		)
	</insert>

	<update id="updateTaskDetailByTaskNo" parameterType="task">
		UPDATE
			TASK
		SET
			PROJ_NO = #{projNo}
			,TITLE = #{title}
			,USER_ID = #{userId}
			,CONTENT = #{content}
			,IMPORTANT = #{important}
			,UPDATEDATE = sysdate
			,STATUS = #{status}
			,STARTDATE = #{startdate}
			,ENDDATE = #{enddate}
		WHERE
			TASK_NO = #{taskNo}
	</update>

	<select id="selectTaskSeqNext" resultType="int">
		SELECT
			TASK_SEQ.NEXTVAL AS TASK_NO FROM DUAL
	</select>
</mapper>